<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<title>Papyrus Users Guide</title>
<style>
 img { border: 0; } a:link {
	color: #0000FF
}
</style>
</head>

<body lang=EN-US>

<div class="h1">
<h1>CDA Tools Guide for Papyrus</h1>
</div>


<p>John T.E. Timm, IBM Research</p>

<p>David A. Carlson, Veterans Health Administration</p>





<div class="h2">
<h2>Installation</h2>
</div>
<p>
See &lt;&lt; insert link here &gt;&gt; for Papyrus Installation
</p>
<div class="h2">
<h2>CDA Models and Runtime</h2>
</div>



<p>The next step is to download the CDA models and runtime from the
software repository at MDHT. Using the subversion client switch to the
SVN Browsing Perspective and create a new repository location as show
below:</p>



<p>Repository Location: <a
	href="http://mdht.projects.openhealthtools.org/svn/mdht">http://mdht.projects.openhealthtools.org/svn/mdht</a></p>

<p>&nbsp;</p>

<p><img  width=438 height=517 src="rsmimages/image003.jpg"/></p>



<p>Where the username and password fields are the login used to sign
in at the OHT website. Check out the following plug-ins into your
workspace (as shown below):</p>

<p>&nbsp;</p>

<p style='text-indent: .5in'>core/plugins/org.openhealthtools.mdht.uml.hl7.datatypes</p>

<p style='text-indent: .5in'>core/plugins/org.openhealthtools.mdht.uml.hl7.vocab</p>

<p style='text-indent: .5in'>cda/plugins/org.openhealthtools.mdht.uml.cda</p>

<p style='text-indent: .5in'>cda/plugins/org.openhealthtools.mdht.uml.cda.ccd</p>

<p style='text-indent: .5in'>cda/plugins/org.openhealthtools.mdht.uml.cda.ihe</p>

<p style='text-indent: .5in'>cda/plugins/org.openhealthtools.mdht.uml.cda.hitsp</p>

<p>&nbsp;</p>

<p><img  width=419 height=169 src="rsmimages/image004.jpg"/></p>

<p>&nbsp;</p>




<div class="h2">
<h2>Introduction</h2>
</div>


<p>                The Modeling Health Tools (MDHT) and the Open
Health Tools are dedicated to providing open source solutions with the
Health Information Industry.  The continuing support of the Eclipse
Papyrus project is result of the ongoing effort to promote and use open
source solutions. </p>


<div class="h2">
<h2>Eclipse Papyrus Project</h2>
</div>

<p>                Papyrus is an open source component of the Model
Development Tools (MDT) subproject to provide an integrated,
user-consumable environment for editing models based on UML.  For a more
complete description of the Papyrus Project please see <a
	href="http://wiki.eclipse.org/MDT/Papyrus-Proposal">MDT Papyrus
Proposal</a>.</p>

<p>The project is schedule to be officially release as part of the
eclipse Helios release in June 2010, see project plan <a
	href="http://www.eclipse.org/projects/project-plan.php?projectid=modeling.mdt">MDT
Plan</a>.  As such, the current Papyrus application is still under
development and is not been officially released.  The MDHT project has
been monitoring the Papyrus project progress and integrating at release
intervals in order to test MDHT tools and provide any necessary feedback
to Papyrus project.</p>

<div class="h2">
<h2>MDHT Papyrus Support</h2>
</div>

<p>                The MDHT projects release of Papyrus is in
response to demand for the CDA tooling in a 100% open source solution. 
As such, the MDHT project has decided to release our internal Papyrus
integration build to allow early adopters and brave souls the
opportunity to use the MDHT tools within the Papyrus UML environment. 
The MDHT Papyrus is provided as is and while we will respond to all
incidents and issues resulting from using MDHT CDA tools within the
environment we can not provide continual updates to the MDHT Papyrus
Integration build in response to any Papyrus UML application issues or
updates.  We will though provide as part of our development activities
release updates as necessary to the MDHT tools in response to issue
within the MDHT tool set.</p>



<div class="h2">
<h2>Getting started with the Example project in Papyrus</h2>
</div>

<p>The purpose of this section is to describe the example project
within the Papyrus application.  We will illustrated some basic Papyrus
features but please refer to the latest version of the Papyrus Users
Guide for additional information <a
	href="http://wiki.eclipse.org/Papyrus_User_Guide">Papyrus User
Guide</a>.   The example project that is available for download from the
MDHT using Subversion, see the Papyrus Installation Guide for more
information (&lt;&lt;LINK TO INSTALLATION&gt;&gt;)</p>


<div class="h2">
<h2>Opening the UML Model</h2>
</div>

<p>                After starting eclipse, switch to the Papyrus
perspective using the Window-&gt;Open Perspecitve-&gt;Other option and
select Papyrus from the list of perspectives.  The next step is to open
the project using the Model  view and navigate to the Example.di file in
the model subdirectory.  Using the right key on the mouse pad select the
Open With-&gt;Papyrus Core Editor (Should be the top option).  If
properly opened, a new folder will appear at the top of the Model view
name example.  A class diagram should appear in the main frame of the
eclipse application.  There are two diagrams that have been created as
part of the model, one and two.  You can switch between the two by
selecting them in the main view table highlighted in the screen shot.</p>

<p><img  width=625 height=500 id="Picture 20"
	src="papyrusimages/image001.jpg"/></p>

<p><img  width=625 height=500 id="Picture 23"
	src="papyrusimages/image002.jpg"/></p>

<p>&nbsp;</p>

<p><img  width=625 height=500 id="Picture 26"
	src="papyrusimages/image003.jpg"/></p>

<p>&nbsp;</p>

<p><img  width=623 height=499 id="Picture 35"
	src="papyrusimages/image004.jpg"/></p>

<p style='text-indent: .5in'>The example project contains a simple
template model that further constrains the CCD (Continuity of Care
Document) model. The model contains three templates: MyDocument,
MySection, and MyActivity. The following class diagram captures the
relationships between the MyDocument and MySection classes and classes
in CCD and the base CDA model. Additionally, it displays the
relationship between MyDocument and MySection. The MyDocument and
MySection templates both contain the &lt;&lt;cdaTemplate&gt;&gt;
stereotype. This indicates, in the diagram, that they further constraint
the ClinicalDocument and Section classes, respectively, from CDA. The
&lt;&lt;cdaTemplate&gt;&gt; stereotype also holds the value of the
template identifier in standard HL7 OID format.</p>

<p style='text-indent: .5in'>&nbsp;</p>

<p><img  width=625 height=500 id="Picture 39"
	src="papyrusimages/image005.jpg"/></p>

<p>The diagram below captures the relationships between MySection
and MyActivity.</p>

<p>&nbsp;</p>

<p><img  width=625 height=500 id="Picture 42"
	src="papyrusimages/image006.jpg"/></p>

<p>These diagrams should give you a feel for the various classes,
properties, and relationships in a CDA template model. You will notice
that the attributes defined in MyDocument, MySection, and MyActivity
mirror those defined in their parent classes from CCD and CDA. These
attributes are used to further constrain the attribute definitions from
the parent. For example, if a code is optional in the parent, defining
an attribute with the same name and type as the parent but specifying a
minimum cardinality of 1 makes the attribute required. This type of
property redefinition is used during the model-to-model transformation
step to generate OCL constraints that are attached to the template model
classes.</p>

<p>&nbsp;</p>

<p>Relationships between classes that specialize
cda::ClinicalDocument and classes that specialize cda::Section, use
directed associations to indicate a relationships between two templates
in an implementation guide. This type of relationship models conformance
rules such as: MyDocument SHALL contain exactly one MySection and
MySection SHOULD contain one or more MyActivity Additional information
about the conformance rule can be specified in property values for the
&lt;&lt;associationValidation&gt;&gt;, &lt;&lt;entry&gt;&gt;, and
&lt;&lt;entryRelationship&gt;&gt; stereotypes. The CDA Tools property
tab is a convenient mechanism for entering such data:</p>

<p><img  width=623 height=499 id="Picture 45"
	src="papyrusimages/image007.jpg"/></p>

<p>The tab is context-sensitive and will only display the data
fields available for the element selected in the model diagram or tree
view.</p>

<p>Validation severity (a property of the
&lt;&lt;associationValidation&gt;&gt; stereotype) is used to
differentiate whether the relationship is strictly required for an
instance to be considered valid. Validation severity may take on one of
three possible values ERROR (strictly required, SHALL), WARNING
(recommended/best practice, SHOULD), and INFO (optional, MAY).</p>

<p> UML properties defined in the template model are used to place
further constraints on those defined in the parent template model and
base CDA model. For example, MySection.code defines a fixed value for
the section code using stereotype values from the
&lt;&lt;vocabSpecification&gt;&gt; stereotype. The CDA Tools property
tab for MySection.code is shown below. This tab can be used to specify
the Code, Code System, Code System Version, etc. for a particular coded
attribute.</p>

<p><img  width=623 height=499 id="Picture 46"
	src="papyrusimages/image008.jpg"/></p>

<p> In addition to constraints on coded attributes, structural
attributes such as classCode, typeCode, and moodCode can be defined with
a fixed or default value in the template model. MyActivity.classCode and
MyActivity.moodCode are used to illustrate this type of constraint.
Fixed or default value constraints can also be applied to attributes
that use text-based datatypes such as ED or ST as illustrated by the
MySection.title attribute.</p>

<p>&nbsp;</p>



<div class="h2">
<h2>Generating Java from a CDA Template Model</h2>
</div>
<p>&nbsp;</p>

<p>Summary of required steps:</p>

<ol style='margin-top: 0in'  >
	<li>Run build.xml to transform model</li>
	<li>Reload example.genmodel to create EMF Ecore model</li>
	<li>Generate Model Code</li>
</ol>

<p>&nbsp;</p>

<p>Now that we have explored the two diagrams associated with the
example template model, we will begin to look at how this model can be
used to generate a Java-based runtime implementation for producing,
consuming, and validating instances. The first step in the process is to
transform the template model into an implementation model. The
model-to-model transformation is invoked from an Ant build task. In
order to run the transformation, right-click on the build.xml file in
the project root directory and select Run as &gt; Ant Build</p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p><img  width=471 height=273 src="rsmimages/image010.jpg"/></p>

<p>&nbsp;</p>

<p>Make sure that Run in the same JRE as the workspace is selected
from the JRE tab. Then click the Apply button at the bottom of the
dialog and then Run. The console output should look something like this:</p>

<p>&nbsp;</p>

<p><img  width=424 height=277 src="rsmimages/image011.jpg"/></p>

<p>&nbsp;</p>

<p>The original template model is converted into an implementation
model with _Ecore.uml appended to the name. In this example, the
implementation model is named example_Ecore.uml. Constraints defined as
associations and property redefinitions in conjunction with metadata
specified in stereotype property values are transformed into OCL
constraints and annotations that are used for validation and instance
population at runtime. For example, the directed association
relationship that was defined between MyDocument and MySection gets
transformed into the following OCL constraint:</p>

<p>&nbsp;</p>

<p style='margin-left: .5in'><span
	style='font-size: 10.0pt; font-family: "Courier New"'>self.getSection()-&gt;one(section
: cda::Section | section.oclIsKindOf(example::MySection))</span></p>

<p>&nbsp;</p>

<p>The getSection() method is an OCL query method that is defined
in the base CDA model to return all of the sections under a clinical
document by traversing the component.structuredBody.component
association between the ClinicalDocument and Section classes. The rest
of the constraint specifies that exactly one section is of type
MySection (or one of its subclasses).</p>

<p>&nbsp;</p>

<p>The second step in creating a Java runtime implementation is to
create the EMF model that will be used to generate Java source code. The
EMF model is provided for you in this example. The EMF model is composed
of two parts: the Ecore model and the generator model. The Ecore model
is very similar to the UML class model that was created during the
template modeling step. The generator model contains information about
how to transform the Ecore model into Java source code. As you can see
in the diagram below, the Ecore model is named example.ecore and the
generator model is named example.genmodel.</p>

<p>&nbsp;</p>

<p><img  width=222 height=90 src="rsmimages/image012.jpg"/></p>

<p>&nbsp;</p>

<p>In order for changes to the template model to be reflected in
the EMF model after the model-to-model transformation, the EMF generator
model must be <i>reloaded</i>. In order to reload the generator model,
right click on example.genmodel and select Reload from the context
menu.  After the model import dialog pops up, click on the Next button
twice and then click on the Finish button. The new updated generator
model will display in editor view as shown:</p>

<p>&nbsp;</p>

<p><img  width=185 height=153 src="rsmimages/image013.jpg"/></p>

<p>&nbsp;</p>

<p>The third step is to right click on the root element named
Example and select Generate Model Code. This will generate all of the
required Java packages and source files under the src folder of the
project.</p>

<p>&nbsp;</p>

<p><img  width=275 height=139 src="rsmimages/image014.jpg"/></p>

<p>&nbsp;</p>

<p>You can explore the generated code by browsing packages such as
org.openhealthtools.mdht.uml.cda.example under the src folder.</p>

<p>&nbsp;</p>

<p><img  width=297 height=138 src="rsmimages/image015.jpg"/></p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>You will notice a Factory class is generated. This class is used
to create instances of the classes defined in your template model (e.g.
MyActivity) using the following syntax:</p>

<p>&nbsp;</p>

<p style='margin-left: .5in'><span
	style='font-size: 10.0pt; font-family: "Courier New"'>MyActivity
activity = ExampleFactory.eINSTANCE.createMyActivity().init();</span></p>

<p>&nbsp;</p>

<p>Notice the init() method is called after the createMyActivity()
method. This is used to populate the instance with any fixed or default
values that were specified in the template model. This reduces the
number of method calls used to construct a valid instance.</p>

<p>&nbsp;</p>

<p>We have provided a working test driver for this example in the
org.openhealthtools.mdht.uml.cda.example.tests package to demonstrate
the construction of a basic instance using classes from the template
model. Additionally, the driver demonstrates how to use the CDA utility
class to serialize and validate the document.</p>

<p>&nbsp;</p>




<div class=Section4>

<div class="h2">
<h2>Refactoring the Example project into your own project</h2>
</div>

<p>&nbsp;</p>

<p>There is an Ant refactor script that can be used to convert the
example project into a project for your specific needs. This can be
accomplished in three steps:</p>

<p>&nbsp;</p>

<p style='margin-left: .25in; text-indent: -.25in'>1.<span
	style='font: 7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Download and disconnect the example project from the MDHT SVN:</p>

<p style='margin-left: .75in; text-indent: -.25in'>a.<span
	style='font: 7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Check out cda/example/org.openhealthtools.mdht.uml.cda.example</p>

<p style='margin-left: .75in; text-indent: -.25in'>b.<span
	style='font: 7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Right-click on Project and select Team &gt; Disconnect from SVN and
select Also delete SVN meta-information from file system</p>

<p>&nbsp;</p>

<p><img  width=441 height=170 src="rsmimages/image016.jpg"/></p>

<p>&nbsp;</p>

<p>NOTE: It is recommended that you check out a clean copy of the
example to use in this step.</p>

<p>&nbsp;</p>

<p style='margin-left: .25in; text-indent: -.25in'>2.<span
	style='font: 7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Rename the project:</p>

<p style='margin-left: .75in; text-indent: -.25in'>a.<span
	style='font: 7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Right-click on Project and select Refactor &gt; Rename (example:
org.openhealthtools.mdht.uml.cda.phmr)</p>

<p>&nbsp;</p>

<p><img  width=408 height=164 src="rsmimages/image017.jpg"/></p>

<p>&nbsp;</p>

<p style='margin-left: .25in; text-indent: -.25in'>3.<span
	style='font: 7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Edit and run the refactor.xml script:</p>

<p style='margin-left: .75in; text-indent: -.25in'>a.<span
	style='font: 7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Open the refactor.xml script in the Ant or text editor</p>

<p style='margin-left: .75in; text-indent: -.25in'>b.<span
	style='font: 7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Change the property values for the following properties:</p>

<p style='margin-left: 1.25in; text-indent: -1.25in'><span
	style='font: 7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>i.<span style='font: 7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>basePackage (e.g. org.openhealthtools.mdht.uml.cda)</p>

<p style='margin-left: 1.25in; text-indent: -1.25in'><span
	style='font: 7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>ii.<span style='font: 7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>packageName (e.g. phmr)</p>

<p style='margin-left: 1.25in; text-indent: -1.25in'><span
	style='font: 7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>iii.<span style='font: 7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>prefix (PHMR)</p>

<p style='margin-left: 1.25in; text-indent: -1.25in'><span
	style='font: 7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>iv.<span style='font: 7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>nsURI (e.g. <a href="http://www.openhealthtools.org/mdht/uml/cda/phmr">http://www.openhealthtools.org/mdht/uml/cda/phmr</a>)</p>

<p style='margin-left: .75in; text-indent: -.25in'>c.<span
	style='font: 7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Run the refactor.xml script as an Ant build using the same instructions
found in the previous section. Make sure to run in the same JRE as the
workpace.</p>

<p>&nbsp;</p>

<p><img  width=577 height=86 src="rsmimages/image018.jpg"/></p>

<p>&nbsp;</p>

</div>


<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-11131278-3");
pageTracker._trackPageview();
} catch(err) {}</script>

</body>

</html>
